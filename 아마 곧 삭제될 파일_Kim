# 필요한 라이브러리를 불러옵니다.
import pandas as pd
from wordcloud import WordCloud
import matplotlib.font_manager as fm
import matplotlib.pyplot as plt
import re
from tqdm.auto import tqdm

# Google Colab에서 나눔 폰트를 설치합니다.
!apt -qq -y install fonts-nanum > /dev/null

# 트레인 데이터를 불러옵니다.
train_data = pd.read_csv('/content/boom_final.csv')
print('데이터 개수:', len(train_data))

# 문자열이 아닌 데이터를 모두 제거합니다.
train_review = [review for review in train_data['댓글'] if type(review) is str]

# 불용어 목록 파일을 불러옵니다. 인코딩 문제 해결 및 줄바꿈 문자 정규화를 위해 수정
with open('/content/stopwords.txt', 'r', encoding='utf-8') as f:
    stopwords = [line.strip().replace('\r', '') for line in f.readlines()]

# 불용어를 제거하고, 대소문자 및 특수문자 처리합니다.
filtered_review = []
for review in tqdm(train_review, desc="리뷰 처리 중"):
    review = review.lower()  # 소문자로 변환합니다.
    review = re.sub(r'[^가-힣\s]', '', review)  # 한글과 공백을 제외한 모든 문자를 제거합니다.
    words = review.split()  # 공백을 기준으로 단어를 분리합니다.

    filtered_words = [word for word in words if word not in stopwords]  # 불용어가 아닌 단어만 선택합니다.
    filtered_review.append(' '.join(filtered_words))


        # 수정: 불용어 제거 과정에서의 진행 상황을 보여줍니다.
    filtered_words = []
    for word in tqdm(words, desc="불용어 제거 중", leave=False):
        if word not in stopwords:
            filtered_words.append(word)

    filtered_review.append(' '.join(filtered_words))

# 한글 폰트 경로를 설정합니다.
fontpath = '/usr/share/fonts/truetype/nanum/NanumBarunGothic.ttf'
font = fm.FontProperties(fname=fontpath, size=9)

# 워드 클라우드를 생성합니다.
wordcloud = WordCloud(font_path=fontpath, background_color='white', width=800, height=800, stopwords=set(stopwords)).generate(' '.join(filtered_review))

# 워드 클라우드를 그립니다.
plt.figure(figsize=(8, 8))
plt.imshow(wordcloud, interpolation='bilinear')
plt.axis('off')
plt.show
